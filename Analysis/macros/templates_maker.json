{
   "#" : "---------------------------------------------------------------------------------------------------------------------",
   "#" : "Configuration file for templates_maker.py script.",
   "#" : "Run as ./templates_maker.py --load templates_maker.json --input-dir <input_dir> -o <outfile>",

   "#" : "Note: comments are not supported in JSON.",
   "#" : "The trick here is to encapsulate them as well formatted input with key #",
   "#" : "Configuration items are commented prepending an _ to the name (any other character would work)",

    "#" : "---------------------------------------------------------------------------------------------------------------------",
    "#" : "Dataset definition                                                                                                   ",
    "#" : "---------------------------------------------------------------------------------------------------------------------",
    "#" : "  %(sel)s is replaced with the appropriate string                                                                    ",
    "#" : "  fromat is <sample-name>:[[input-file][/file-folder]] order irrelevant                                                               ",
	
    "#" : "data to be fit                                                                                                       ",
    "data" : [
               "GGJets_M_200To13000_sherpa_13TeV:output.root/%(sel)sGenIso",
               "GGJets_M_200To13000_sherpa_13TeV:output.root/%(sel)sNonGenIso",
               "QCD_HT_100toInf_13TeV:output.root/%(sel)s",
               "GJets_HT_100toInf_13TeV:output.root/%(sel)s"            
             ],
    "#" : "FIXME: put back GGJets_M_200To13000_sherpa_13TeV:output.root/%(sel)sNonGenIso into the list of samples",	     

    "#" : "data used for template making",
    "templates" : [
               "GGJets_M_200To13000_sherpa_13TeV:output.root/%(sel)s",
               "QCD_HT_100toInf_13TeV:output.root/%(sel)s",
               "GJets_HT_100toInf_13TeV:output.root/%(sel)s"            
             ],
             
     "#" : "mc dataset",
     "mc" : [
             "GGJets_M_200To13000_sherpa_13TeV:output.root/%(sel)sGenIso",
               "GGJets_M_200To13000_sherpa_13TeV:output.root/%(sel)sNonGenIso",
               "QCD_HT_100toInf_13TeV:output.root/%(sel)s",
               "GJets_HT_100toInf_13TeV:output.root/%(sel)s"            
            ],

     "#" : "mc dataset",
      "signals" : {
     	       	 "grav_001_750" : ["RSGravToGG_kMpl_001_M_750_13TeV:output.root/%(sel)sGenIso",
		       		  "RSGravToGG_kMpl_001_M_750_13TeV:output.root/%(sel)sNonGenIso"
		       		  ],
     	       	 "grav_001_1500" : ["RSGravToGG_kMpl_001_M_1500_13TeV:output.root/%(sel)sGenIso",
		       		  "RSGravToGG_kMpl_001_M_1500_13TeV:output.root/%(sel)sNonGenIso"
		       		  ],
      	       	 "grav_01_1500" : ["RSGravToGG_kMpl_01_M_1500_13TeV:output.root/%(sel)sGenIso",
		       		  "RSGravToGG_kMpl_01_M_1500_13TeV:output.root/%(sel)sNonGenIso"
		       		  ],
      	       	 "grav_02_1500" : ["RSGravToGG_kMpl_02_M_1500_13TeV:output.root/%(sel)sGenIso",
		       		  "RSGravToGG_kMpl_02_M_1500_13TeV:output.root/%(sel)sNonGenIso"
		       		  ],
     	       	 "grav_02_3000" : ["RSGravToGG_kMpl_02_M_3000_13TeV:output.root/%(sel)sGenIso",
		       		  "RSGravToGG_kMpl_02_M_3000_13TeV:output.root/%(sel)sNonGenIso"
		       		  ],
     	       	 "grav_01_3000" : ["RSGravToGG_kMpl_01_M_3000_13TeV:output.root/%(sel)sGenIso",
		       		  "RSGravToGG_kMpl_01_M_3000_13TeV:output.root/%(sel)sNonGenIso"
		       		  ],
     	       	 "grav_02_5000" : ["RSGravToGG_kMpl_02_M_5000_13TeV:output.root/%(sel)sGenIso",
		       		  "RSGravToGG_kMpl_02_M_5000_13TeV:output.root/%(sel)sNonGenIso"
		       		  ],
     	       	 "grav_001_5000" : ["RSGravToGG_kMpl_001_M_5000_13TeV:output.root/%(sel)sGenIso",
		       		  "RSGravToGG_kMpl_001_M_5000_13TeV:output.root/%(sel)sNonGenIso"
		       		  ]
            },

    "#" : "file names for different datasets. Files folder can be specified by --input-dir on the command line",
    "data_file"  : "output.root",
    "mc_file"    : "output.root",
    "templates_file" : null, "#" : "implies to use same as data",

    "#" : "categories for the input datasets",
    "categories" : [],
    "#" :  "groups of categories can be defined to resum some of the categories",
    "groups": {
        "EBHighR9"   : ["EBHighR9"],
        "EBLowR9"    : ["EBLowR9"],
        "EEHighR9"   : ["EEHighR9"],
        "EELowR9"    : ["EELowR9"],
        "EBEB"       : ["EBHighR9","EBLowR9"],
        "notEBEB"    : ["EEHighR9","EELowR9"],
        "eta_inclusive"    : ["EBHighR9","EBLowR9","EEHighR9","EELowR9"]
        }, 

    "#" : "how to compose the tree name starting from sub-pieces       ",
    "#" : " %(sample)s is replaced with the items in dataset definition",
    "#" : " %(cat)s is replaced with the category name                 ", 
    "treeName": "trees/%(sample)s_%(cat)s",

    "preselection" : "leadChIso < 15. && subleadChIso < 15. && mass > 250",   "#" : "preselection cut applied to all trees",
    "selection"    : "cicNoChIso",                              "#" : "nominal selection",
    
    "#" : "---------------------------------------------------------------------------------------------------------------------",
    "#" : "Fit definition                                                                                                       ",
    "#" : "---------------------------------------------------------------------------------------------------------------------",

    "dataset_variables" : ["rho","nvtx","run","event"],     "#" :"list of variables to be put in the dataset (other than the template ones)",
    "weight_expression" : "weight",           "#" :"event weight expression  ",

    "#" : "List of aliases. Used to define variables/simplify expressions selection.",
    "aliases"  : [ 
               "phoIsEB    := abs(phoScEta) < 1.5",
               "phoIsSB    := (((phoPhoIso - rho*phoPhoIsoEA) -0.002*phoPt < 2. ) && (phoIsEB    && (phoSigmaIeIe    > 0.012) ))||( ((phoPhoIso - rho*phoPhoIsoEA) -0.002*phoPt < 11. ) &&!phoIsEB    && (phoSigmaIeIe>0.035 )  )",
               "leadIsEB    := abs(leadScEta) < 1.5",
               "subleadIsEB := abs(subleadScEta) < 1.5",
               "_leadIsSB := leadIsEB && (leadSigmaIeIe > 0.012) || !leadIsEB && (leadSigmaIeIe>0.035)",
               "leadIsSB := (((leadPhoIso - rho*leadPhoIsoEA) -0.002*leadPt < 2. ) && (leadIsEB    && (leadSigmaIeIe    > 0.012) ))||( ((leadPhoIso - rho*leadPhoIsoEA) -0.002*leadPt < 11. ) &&!leadIsEB    && (leadSigmaIeIe>0.035     )  )",
               "_subleadIsSB := subleadIsEB && (subleadSigmaIeIe > 0.012) || !subleadIsEB && (subleadSigmaIeIe>0.035)",
               "subleadIsSB := ((((subleadPhoIso - rho*subleadPhoIsoEA) -0.002*subleadPt < 2. ) && (subleadIsEB    && (subleadSigmaIeIe    > 0.012) ))||( ((subleadPhoIso - rho*subleadPhoIsoEA) -0.002*subleadPt < 11. ) &&!subleadIsEB    && (subleadSigmaIeIe>0.035     )) )",
               "leadPrompt    := leadGenIso < 10. && leadMatchType == 1",
               "leadFake      := ! leadPrompt",
               "subleadPrompt := subleadGenIso < 10. && subleadMatchType == 1",
               "subleadFake   := ! subleadPrompt",
               "phoPrompt := phoGenIso < 10. && phoMatchType == 1",
               "phoFake   := ! phoPrompt",
	       "mgg := mass"
    ],

    "#" :"List of fits.",
    "#" :"General form is <fit-name> : { <fit-config> }",
        
    "fits" : {
        "cic" : {
            "ndim"       : 2,                                                                "#" : "number of dimensions for the template  ",
            "bins"       : [ "mass", [500.0,1300.0] ],                                       "#" : "kinematic bins in which the fit is run ",
            "template_binning" : [ 0.0, 0.1, 5.0, 15.0 ],                                    "#" : "template varaible binning              ",
		
            "selection"    : "cic",
            "components" : [ "pp", "pf", "ff" ],                                             "#" : "list of fit components                 ",
            "dataset_variables" : ["mgg","mass [-1.0,0.0,20.0,50.0,100.0,200.0,500.0,13000.0]","leadPt","subleadPt","leadEta","subleadEta", "leadMatchType", "subleadMatchType"],      "#" : "additional variables to be stored      ",
            "store_trees" : true,	

            "#" :"categories in which to split the fit       ",
            "#" :"format is <fit-category-name>: { <config> }",
            "categories" : {
                "EBHighR9" : { 
                    "src"  : "EBHighR9", "#" : "dataset category (or group) to use as input.",
                     "#" :"instruction for how to fill the templates                                                                     ",
                     "#" :" format is <condition> : [ <list-of-expressions> ]. the lenght of <list-of-expressions> has to be exactly ndim",

                     "#" :"Pseudo-random-swap.                    ",
                     "#" :" For even events order is lead,sublead.",
                     "#" :" For odd events sublead,lead           ",
                     "fill" : { 
                     "TMath::Even(event)" :[ "leadChIso", "subleadChIso" ],
                         "! TMath::Even(event)" :[ "subleadChIso", "leadChIso" ]
                      }
                }, 
                "EBLowR9" : { 
                    "src"  : "EBLowR9", "#" : "dataset category (or group) to use as input.",
                     "#" :"instruction for how to fill the templates                                                                     ",
                     "#" :" format is <condition> : [ <list-of-expressions> ]. the lenght of <list-of-expressions> has to be exactly ndim",

                     "#" :"Pseudo-random-swap.                    ",
                     "#" :" For even events order is lead,sublead.",
                     "#" :" For odd events sublead,lead           ",
                     "fill" : { 
                     "TMath::Even(event)" :[ "leadChIso", "subleadChIso" ],
                         "! TMath::Even(event)" :[ "subleadChIso", "leadChIso" ]
                      }
                }, 
                "EEHighR9" : { "src" : "EEHighR9" ,
                        "#" : "Here first photon is barrel, second is endcap",
                        "fill" : { 
                        "leadIsEB && ! subleadIsEB" :[ "leadChIso", "subleadChIso" ],
                            "! leadIsEB && subleadIsEB" :[ "subleadChIso", "leadChIso" ]
                       }
                },
                "EELowR9" : { "src" : "EELowR9" ,
                        "#" : "Here first photon is barrel, second is endcap",
                        "fill" : { 
                        "leadIsEB && ! subleadIsEB" :[ "leadChIso", "subleadChIso" ],
                        "! leadIsEB && subleadIsEB" :[ "subleadChIso", "leadChIso" ]
                       }
                } 
            },
	    "signals" : "__all__", 
		"truth_selection" : {
		    "pp" : "leadPrompt  && subleadPrompt",
			"pf" : "(leadPrompt && subleadFake) || (subleadPrompt && leadFake)",
                    "ff" : "leadFake    && subleadFake && ( leadMatchType != 0 || subleadMatchType != 0)"
			},
            "templates" : {
                "pf" : { 
		        "sel"  : "cicNoChIsoSingleSB", 
                        "#" : "pseudo-random swap, but taking care to take the random cone isolation for the signal-region photon",
                        "#" : "  and the photon isolation for the side-band one                                                  ",
                        "fill_categories" : { 
                        "EBHighR9" :{ "leadIsSB && TMath::Even(event)" :    [ "leadChIso", "subleadRndConeChIso" ],
                                "leadIsSB && ! TMath::Even(event)" :    [ "subleadRndConeChIso", "leadChIso" ],
                                "subleadIsSB && ! TMath::Even(event)" : [ "subleadChIso", "leadRndConeChIso" ],
                                "subleadIsSB && ! TMath::Even(event)" : [ "leadRndConeChIso", "subleadChIso" ]
                        },
                        "EBLowR9" :{ "leadIsSB && TMath::Even(event)" :    [ "leadChIso", "subleadRndConeChIso" ],
                                "leadIsSB && ! TMath::Even(event)" :    [ "subleadRndConeChIso", "leadChIso" ],
                                "subleadIsSB && ! TMath::Even(event)" : [ "subleadChIso", "leadRndConeChIso" ],
                                "subleadIsSB && ! TMath::Even(event)" : [ "leadRndConeChIso", "subleadChIso" ]
                        },
                        "EEHighR9" :{ "leadIsEB && ! subleadIsEB &&      leadIsSB" : [ "leadRndConeChIso", "subleadChIso" ], 
                                "leadIsEB && ! subleadIsEB &&    ! leadIsSB" : [ "leadChIso", "subleadRndConeChIso" ], 
                                "! leadIsEB && subleadIsEB &&   subleadIsSB" : [ "subleadChIso", "leadRndConeChIso" ], 
                                "! leadIsEB && subleadIsEB && ! subleadIsSB" : [ "subleadChIso", "leadRndConeChIso" ]
                                },
                        "EELowR9" :{ "leadIsEB && ! subleadIsEB &&      leadIsSB" : [ "leadRndConeChIso", "subleadChIso" ], 
                                "leadIsEB && ! subleadIsEB &&    ! leadIsSB" : [ "leadChIso", "subleadRndConeChIso" ], 
                                "! leadIsEB && subleadIsEB &&   subleadIsSB" : [ "subleadChIso", "leadRndConeChIso" ], 
                                "! leadIsEB && subleadIsEB && ! subleadIsSB" : [ "subleadChIso", "leadRndConeChIso" ]
				}
                        }			
		    }
	    }
	},	
        "cic2" : {
            "ndim"       : 2,                                                                "#" : "number of dimensions for the template  ",
            "bins"       : [ "mass", [500.0,1300.0] ],                                       "#" : "kinematic bins in which the fit is run ",
            "template_binning" : [ 0.0, 0.1, 5.0, 15.0 ],                                    "#" : "template varaible binning              ",
		
            "selection"    : "cic",
            "components" : [ "pp", "pf", "ff" ],                                             "#" : "list of fit components                 ",
            "dataset_variables" : ["mgg","mass [-1.0,0.0,20.0,50.0,100.0,200.0,500.0,13000.0]","leadPt","subleadPt","leadEta","subleadEta", "leadMatchType", "subleadMatchType"],      "#" : "additional variables to be stored      ",
            "store_trees" : true,	
            "categories" : {
                "EBEB" : { 
                    "src"  : "EBEB",
                     "fill" : { 
                         "TMath::Even(event)" :[ "leadChIso", "subleadChIso" ],
                         "! TMath::Even(event)" :[ "subleadChIso", "leadChIso" ]
                      }
                }, 
                "EBEE" : { "src" : "notEBEB" ,
                        "fill" : { 
                        "leadIsEB && ! subleadIsEB" :[ "leadChIso", "subleadChIso" ],
                            "! leadIsEB && subleadIsEB" :[ "subleadChIso", "leadChIso" ]
                       }
                }
            },
	    "signals" : "__all__", 
		"truth_selection" : {
		    "pp" : "leadPrompt  && subleadPrompt",
			"pf" : "(leadPrompt && subleadFake) || (subleadPrompt && leadFake)",
                    "ff" : "leadFake    && subleadFake && ( leadMatchType != 0 || subleadMatchType != 0)"
			},
            "templates" : {
                "pf" : { 
		        "sel"  : "cicNoChIsoSingleSB", 
                        "fill_categories" : { 
                        "EBEB" :{ "leadIsSB && TMath::Even(event)" :    [ "leadChIso", "subleadRndConeChIso" ],
                                "leadIsSB && ! TMath::Even(event)" :    [ "subleadRndConeChIso", "leadChIso" ],
                                "subleadIsSB && ! TMath::Even(event)" : [ "subleadChIso", "leadRndConeChIso" ],
                                "subleadIsSB && ! TMath::Even(event)" : [ "leadRndConeChIso", "subleadChIso" ]
                        },
                        "EBEE" :{ "leadIsEB && ! subleadIsEB &&      leadIsSB" : [ "leadRndConeChIso", "subleadChIso" ], 
                                "leadIsEB && ! subleadIsEB &&    ! leadIsSB" : [ "leadChIso", "subleadRndConeChIso" ], 
                                "! leadIsEB && subleadIsEB &&   subleadIsSB" : [ "subleadChIso", "leadRndConeChIso" ], 
                                "! leadIsEB && subleadIsEB && ! subleadIsSB" : [ "subleadChIso", "leadRndConeChIso" ]
                                }
                        }			
		    }
	    }
	},	
        "2D" : {
            "ndim"       : 2,                                                                "#" : "number of dimensions for the template  ",
            "bins"       : [ "mass", [500.0,1300.0] ],                                       "#" : "kinematic bins in which the fit is run ",
            "template_binning" : [ 0.0,0.1, 1.0, 4.0,9.0, 15.0 ],                                   "#" : "template varaible binning              ",

            "components" : [ "pp", "pf", "ff" ],                                             "#" : "list of fit components                 ",
		"dataset_variables" : ["mgg","mass [-1.0,0.0,20.0,50.0,100.0,200.0,500.0,13000.0]","leadPt","subleadPt","leadEta","subleadEta", "leadScEta","subleadScEta","leadMatchType", "subleadMatchType","leadPhoIso","subleadPhoIso"],      "#" : "additional variables to be stored      ",
            "store_trees" : true,	
            "preselection" : "!(leadFake    && subleadFake && ( leadMatchType == 0 && subleadMatchType == 0)) && (leadChIso < 15. && subleadChIso < 15. && mass > 250)",
            "#" :"categories in which to split the fit       ",
            "#" :"format is <fit-category-name>: { <config> }",
            "categories" : {
                "EBEB" : { 
                    "src"  : "EBEB", "#" : "dataset category (or group) to use as input.",
                     "#" :"instruction for how to fill the templates                                                                     ",
                     "#" :" format is <condition> : [ <list-of-expressions> ]. the lenght of <list-of-expressions> has to be exactly ndim",

                     "#" :"Pseudo-random-swap.                    ",
                     "#" :" For even events order is lead,sublead.",
                     "#" :" For odd events sublead,lead           ",
                     "fill" : { 
                     "TMath::Even(event)" :[ "leadChIso", "subleadChIso" ],
                         "! TMath::Even(event)" :[ "subleadChIso", "leadChIso" ]
                      }
                }, 
                "EBEE" : { "src" : "notEBEB" ,
                        "#" : "Here first photon is barrel, second is endcap",
                        "fill" : { 
                        "leadIsEB && ! subleadIsEB" :[ "leadChIso", "subleadChIso" ],
                            "! leadIsEB && subleadIsEB" :[ "subleadChIso", "leadChIso" ]
                       }
                }
            },
            
            "#" :"MC truth selection.                                      ",
            "#" :"  This is applied to all fit categories in mc",
            "truth_selection" : {
                "pp" : "leadPrompt  && subleadPrompt",
                    "pf" : "(leadPrompt && subleadFake) || (subleadPrompt && leadFake)",
                    "ff" : "leadFake    && subleadFake && ( leadMatchType != 0 || subleadMatchType != 0)"
            },

            "#" :"Template creation.                      ",
            "#" :"  Format is <component> : { <settings> }",
            "templates" : {
                "pp" : { 
		        "sel"  : "cicNoChIso", "#" : "event selection",
                        "dataset" : "data",    "#" : "input dataset. can be data,mc or templates",
                        "#" : "How to fill different categories. Logic is the same as for the 'fill' instructions above",
                        "fill_categories" : {
                        "EBEB" :{"TMath::Even(event)" : [ "leadRndConeChIso", "subleadRndConeChIso" ],
                                 "! TMath::Even(event)" : [ "subleadRndConeChIso", "leadRndConeChIso" ]
                                },
                        "EBEE" :{ "leadIsEB && ! subleadIsEB" : [ "leadRndConeChIso", "subleadRndConeChIso" ], 
                                "! leadIsEB && subleadIsEB" : [ "subleadRndConeChIso", "leadRndConeChIso" ]
                                }
                            }
                },
                "pf" : { 
		        "sel"  : "cicNoChIsoSingleSB", 
                        "#" : "pseudo-random swap, but taking care to take the random cone isolation for the signal-region photon",
                        "#" : "  and the photon isolation for the side-band one                                                  ",
                        "fill_categories" : { 
                        "EBEB" :{ "leadIsSB && TMath::Even(event)" :    [ "leadChIso", "subleadRndConeChIso" ],
                                "leadIsSB && ! TMath::Even(event)" :    [ "subleadRndConeChIso", "leadChIso" ],
                                "subleadIsSB && ! TMath::Even(event)" : [ "subleadChIso", "leadRndConeChIso" ],
                                "subleadIsSB && ! TMath::Even(event)" : [ "leadRndConeChIso", "subleadChIso" ]
                        },
                        "EBEE" :{ "leadIsEB && ! subleadIsEB &&      leadIsSB" : [ "leadChIso", "subleadRndConeChIso" ], 
                                "leadIsEB && ! subleadIsEB &&    ! leadIsSB" : [ "leadRndConeChIso", "subleadChIso" ], 
                                "! leadIsEB && subleadIsEB &&   subleadIsSB" : [ "subleadChIso", "leadRndConeChIso" ], 
                                "! leadIsEB && subleadIsEB && ! subleadIsSB" : [ "subleadRndConeChIso", "leadChIso" ]
                                }
                        }
                 },
                 "ff" : { "sel"  : "cicNoChIsoDoubleSB",        
                         "fill_categories" : {
                         "EBEB" :{ "TMath::Even(event)" : [ "leadChIso", "subleadChIso" ],
                                 "! TMath::Even(event)" : [ "subleadChIso", "leadChIso" ]
                                 },
                         "EBEE" :{ "leadIsEB && ! subleadIsEB" : [ "leadChIso", "subleadChIso" ],
                                 "! leadIsEB && subleadIsEB" : [ "subleadChIso", "leadChIso" ]
                                 }
                            }
                        }
                }
        },

        "1D" : {
            "#" : "1D fit: same as above, with (possible) additional loop over legs",
            "ndim"       : 1,
            "bins"       : [ "mass", [500.0,1300.0] ],
		"dataset_variables" : ["mass [-1.0,0.0,20.0,50.0,100.0,200.0,500.0,13000.0]","phoPt := %(leg)sPt","phoEta := %(leg)sEta","phoScEta := %(leg)sScEta", "phoPhi := %(leg)sPhi","phoEnergy := %(leg)sPt*cosh(%(leg)sEta)","phoPhoIso := %(leg)sPhoIso",
				       "phoSigmaIeIe := %(leg)sSigmaIeIe",
				       "phoGenIso := %(leg)sGenIso", "phoMatchType := %(leg)sMatchType",
                                        "phoPhoIso:= %(leg)sPhoIso",
                                        "phoPhoIsoEA:= %(leg)sPhoIsoEA"
				       ],
            "template_binning" : [-1.0, 0.0,0.1, 1.0, 4.0,9.0, 15.0 ],
            "components" : ["p", "f"],
            "store_trees" : true,	

            "#" : "loop over legs defined here",
            "#" : " %(leg)s replaced with these values",
            "legs" : ["lead","sublead"],
                
            "categories" : { 
                "EBEB" : { 
                    "src" : "EBEB",
                        "fill" : { "1" : ["%(leg)sChIso"] }
                }, 
                "eta_inclusive" : { 
                    "src" : "eta_inclusive",
                        "fill" : { "1" : ["%(leg)sChIso"] }
                }, 
                "EBEE" : {
                    "src" : "notEBEB",
                        "fill" : { "%(leg)sIsEB" : ["%(leg)sChIso"] }

                },
                "EEEB" : {
                    "src" : "notEBEB",
                        "fill" : { "! %(leg)sIsEB" : ["%(leg)sChIso"] }

                }
            },
            "truth_selection" : {
                "p" : "%(leg)sPrompt",
                "f" : "%(leg)sFake"
            },
            "templates" : {
                "p" : {
                    "sel" : "cicNoChIso",
                    "dataset" : "data",
                        "fill_categories" : { 
                            "EBEB" : { "1" : ["%(leg)sRndConeChIso"] },
                            "EBEE" : { "%(leg)sIsEB" : ["%(leg)sRndConeChIso"] },
                            "EEEB" : { "! %(leg)sIsEB" : ["%(leg)sRndConeChIso"] },
                            "eta_inclusive" : { "1" : ["%(leg)sRndConeChIso"] }
                    }
                },
                "f" : { 
                    "sel" : "cicNoChIsoSingleSB",
                        "fill_categories" : { 
                        "EBEB" : { "%(leg)sIsSB                 " : ["%(leg)sChIso"] },
                        "EBEE" : { "%(leg)sIsSB &&   %(leg)sIsEB" : ["%(leg)sChIso"] },
			"EEEB" : { "%(leg)sIsSB && ! %(leg)sIsEB" : ["%(leg)sChIso"] },
                        "eta_inclusive" : { "%(leg)sIsSB" : ["%(leg)sChIso"] }
                    }
                },
                "f1" : { 
                    "sel" : "cicNoChIsoSingleSB",
                        "fill_categories" : { 
                        "EBEB" : { "TMath::Even(event) && %(leg)sIsSB &&                  %(leg)sSigmaIeIe>0.012" : ["%(leg)sChIso"] },
                        "EBEE" : { "TMath::Even(event) && %(leg)sIsSB &&   %(leg)sIsEB && %(leg)sSigmaIeIe>0.012" : ["%(leg)sChIso"] },
                        "EEEB" : { "TMath::Even(event) && %(leg)sIsSB && ! %(leg)sIsEB && %(leg)sSigmaIeIe>0.035" : ["%(leg)sChIso"] },
                        "eta_inclusive" : { "TMath::Even(event) && %(leg)sIsSB" : ["%(leg)sChIso"] }
                    }
                },
                "f2" : { 
                    "sel" : "cicNoChIsoSingleSB",
                        "fill_categories" : { 
                        "EBEB" : { "! TMath::Even(event) && %(leg)sIsSB &&                  %(leg)sSigmaIeIe>0.012" : ["%(leg)sChIso"] },
                        "EBEE" : { "! TMath::Even(event) && %(leg)sIsSB &&   %(leg)sIsEB && %(leg)sSigmaIeIe>0.012" : ["%(leg)sChIso"] },
			    "EEEB" : { "! TMath::Even(event) && %(leg)sIsSB && ! %(leg)sIsEB && %(leg)sSigmaIeIe>0.035" : ["%(leg)sChIso"] },
			"eta_inclusive" : { "!TMath::Even(event) && %(leg)sIsSB" : ["%(leg)sChIso"] }
                    }
                }
            }
        },

        "singlePho" : {
            "#" : "single photon: looks at single photon selection",

            "ndim"       : 1,
            "bins"       : [ "phoPt", [100,6000] ],
            "dataset_variables" : ["phoPt","phoPhoIso","phoRndConePhoIso","phoPhoIsoEA","phoEta","phoScEta","phoPhi","phoEnergy := phoPt*cosh(phoEta)","phoSigmaIeIe","phoGenIso","phoMatchType","rho","nvtx"],
            "_template_binning" : [ -10.0, 0.0, 1.0, 1.5, 2.0, 2.5, 3.0, 5.0, 10.0, 15.0 ],
	    "template_binning" : [-1.0,  0.0,0.1, 1.0, 4.0,9.0, 15.0 ],
            "store_trees"  : true,
            "selection"    : "cicNoChIsoSinglePho",
            "_preselection" : "phoChIso < 15.",
            "preselection" : "phoPt >170.",
            "components" : ["p", "f"],
            "categories" : { 
                "EB" : { 
                    "src" : "EBEB",
                        "fill" : { "1" : ["phoChIso"] }
                }, 
                "EE" : {
                    "src" : "notEBEB",
                        "fill" : { "1" : ["phoChIso"] }
                
                },
                "eta_inclusive" :{
                        "src" : "eta_inclusive",
                            "fill" : { "1" : ["phoChIso"] }
				}
            },
            "truth_selection" : {
                "p" : "phoPrompt",
                "f" : "phoFake"
            },
            "templates" : {
                "p" : {
                    "sel" : "cicNoChIsoSinglePho",
                    "_presel" :  "phoRndConePhoIso - rho*phoPhoIsoEA < 4.",
                    "dataset" : "data",
                        "fill_categories" : { 
                            "EB" : { "1" : ["phoRndConeChIso"] },
                            "EE" : { "1" : ["phoRndConeChIso"] },
                            "eta_inclusive" : { "1" : ["phoRndConeChIso"] }
                    }
                },
                "f" : { 
                    "sel" : "cicNoChIsoSBSinglePho",
                        "fill_categories" : { 
                        "EB" : { "phoIsSB" : ["phoChIso"] },
                        "EE" : { "phoIsSB" : ["phoChIso"] },
                        "eta_inclusive" : { "phoIsSB" : ["phoChIso"] }
                    }
				},
                "_fwhigh" : { 
                    "sel" : "cicNoChIsoSBSinglePho",
                        "fill_categories" : { 
                        	"EB" : { "phoIsSB && weight >=1." : ["phoChIso"] },
                        	"EE" : { "phoIsSB && weight >=1." : ["phoChIso"] },
                        	"eta_inclusive" : { "phoIsSB && weight>=1."  : ["phoChIso"] }
                	}
				},
                "_fwlow" : { 
                    "sel" : "cicNoChIsoSBSinglePho",
                        "fill_categories" : { 
                        	"EB" : { "phoIsSB && weight <1." : ["phoChIso"] },
                        	"EE" : { "phoIsSB && weight <1." : ["phoChIso"] },
                        	"eta_inclusive" : { "phoIsSB && weight <1." : ["phoChIso"] }
					}
				},
                "f1" : { 
                    "sel" : "cicNoChIsoSBSinglePho",
                        "fill_categories" : { 
                        "EB" : { "TMath::Even(event) && phoIsSB" : ["phoChIso"] },
                        "EE" : { "TMath::Even(event) && phoIsSB" : ["phoChIso"] },
                        "eta_inclusive" : { "TMath::Even(event) && phoIsSB" : ["phoChIso"] }
                    }
                },
                "f2" : { 
                    "sel" : "cicNoChIsoSBSinglePho",
                        "fill_categories" : { 
                        "EB" : { "!TMath::Even(event) && phoIsSB" : ["phoChIso"] },
                        "EE" : { "!TMath::Even(event) && phoIsSB" : ["phoChIso"] },
                        "eta_inclusive" : { "!TMath::Even(event) && phoIsSB" : ["phoChIso"] }
                    }
                }
            }
        }
    },

    "#" : "---------------------------------------------------------------------------------------------------------------------",
    "#" : "Template mixing                                                                                                      ",
    "#" : "---------------------------------------------------------------------------------------------------------------------",
    "_mix" : { 
	"_kDClosure2D" : {
	    "target" : "2D",
		"ptLeadMin" : 100.0, "ptSubleadMin" : 100.0, "massMin" : 200.0,
		"pt" : "phoPt", "eta" : "phoEta", "phi" : "phoPhi", "energy" : "phoEnergy",
		"_sources" : { 
		"pp" : [ "1D:mctruth:p", "1D:mctruth:p" ]
		    }, 
		"sources" : { 
		"pf" : [ "1D:p", "1D:f" ]
		    }, 
		"_sources" : { 
		"pf" : [ "1D:mctruth:p", "1D:mctruth:f" ]
		    }, 
		"replace" : "pho",
		"type" : "kdtree",
		    
		"_fill_categories" : {
		    "EBEE" : { "legs" : ["eta_inclusive","eta_inclusive"], "rndswap" : false, "nNeigh" : 10, "matchWithThreshold" : false,
			    "useCdfDistance" : true, "targetFraction" : 5e-2, "maxWeight" : 0.1, "rndmatch":0.9,
			    "axesWeights" : [10.0,1.0,-1.0],
			    "match1"  : ["log(phoPt)" ,"TMath::Abs(phoScEta)","TMath::Abs(phoScEta)<1.5"    ], 
			    "match2"  : ["log(phoPt)" ,"TMath::Abs(phoScEta)","TMath::Abs(phoScEta)<1.5"    ], 
			    "target1" : [
					 "log((TMath::Abs(leadScEta)<TMath::Abs(subleadScEta))*leadPt       + (TMath::Abs(leadScEta)>=TMath::Abs(subleadScEta))*subleadPt)",
					 "(TMath::Abs(leadScEta)<TMath::Abs(subleadScEta))*TMath::Abs(leadScEta)    + (TMath::Abs(leadScEta)>=TMath::Abs(subleadScEta))*TMath::Abs(subleadScEta)",
					 "((TMath::Abs(leadScEta)<TMath::Abs(subleadScEta))*TMath::Abs(leadScEta)    + (TMath::Abs(leadScEta)>=TMath::Abs(subleadScEta))*TMath::Abs(subleadScEta))<1.5"
					 ],
			    "target2" : [
					 "log((TMath::Abs(leadScEta)<TMath::Abs(subleadScEta))*subleadPt    + (TMath::Abs(leadScEta)>=TMath::Abs(subleadScEta))*leadPt)",
					 "(TMath::Abs(leadScEta)<TMath::Abs(subleadScEta))*TMath::Abs(subleadScEta) + (TMath::Abs(leadScEta)>=TMath::Abs(subleadScEta))*TMath::Abs(leadScEta)[0.3]",
					 "((TMath::Abs(leadScEta)<TMath::Abs(subleadScEta))*TMath::Abs(subleadScEta) + (TMath::Abs(leadScEta)>=TMath::Abs(subleadScEta))*TMath::Abs(leadScEta))<1.5"
					 ]
			    }
		},
		"_fill_categories" : {
			"EBEB" : { "legs" : ["EBEB","EBEB"], "rndswap" : true, "nNeigh" : 25, "matchWithThreshold" : false,
			    "useCdfDistance" : true, "targetFraction" : 1e-3, "maxWeight" : 0.005, "rndmatch":0.8,
				"axesWeights" : [4.0,1.0,1.0],
			    "match1"  : ["phoPhoIso","log(phoPt)" ,"TMath::Abs(phoScEta)"    ], 
			    "match2"  : ["phoPhoIso","log(phoPt)" ,"TMath::Abs(phoScEta)"    ], 
				"target1" : ["leadPhoIso",
					 "log(leadPt)",
					 "TMath::Abs(leadScEta)"
					 ],
			    "target2" : ["subleadPhoIso",
					 "log(subleadPt)",
					 "TMath::Abs(subleadScEta)"
					 ]			
				}
		},
		"fill_categories" : {
		    "EBEE" : { "legs" : ["eta_inclusive","eta_inclusive"], "rndswap" : false, "nNeigh" : 25, "matchWithThreshold" : false,
			    "useCdfDistance" : true, "targetFraction" : 1e-3, "maxWeight" : 0.005, "rndmatch":0.8,
			    "axesWeights" : [4.0,1.0,1.0,-1.0],
			    "match1"  : ["phoPhoIso","log(phoPt)" ,"TMath::Abs(phoScEta)","TMath::Abs(phoScEta)<1.5"    ], 
			    "match2"  : ["phoPhoIso","log(phoPt)" ,"TMath::Abs(phoScEta)","TMath::Abs(phoScEta)<1.5"    ], 
			    "target1" : ["(TMath::Abs(leadScEta)<TMath::Abs(subleadScEta))*leadPhoIso + (TMath::Abs(leadScEta)>=TMath::Abs(subleadScEta))*subleadPhoIso[10]",
					 "log((TMath::Abs(leadScEta)<TMath::Abs(subleadScEta))*leadPt       + (TMath::Abs(leadScEta)>=TMath::Abs(subleadScEta))*subleadPt)",
					 "(TMath::Abs(leadScEta)<TMath::Abs(subleadScEta))*TMath::Abs(leadScEta)    + (TMath::Abs(leadScEta)>=TMath::Abs(subleadScEta))*TMath::Abs(subleadScEta)",
					 "((TMath::Abs(leadScEta)<TMath::Abs(subleadScEta))*TMath::Abs(leadScEta)    + (TMath::Abs(leadScEta)>=TMath::Abs(subleadScEta))*TMath::Abs(subleadScEta))<1.5"
					 ],
			    "target2" : ["(TMath::Abs(leadScEta)<TMath::Abs(subleadScEta))*subleadPhoIso + (TMath::Abs(leadScEta)>=TMath::Abs(subleadScEta))*leadPhoIso[10]",
					 "log((TMath::Abs(leadScEta)<TMath::Abs(subleadScEta))*subleadPt    + (TMath::Abs(leadScEta)>=TMath::Abs(subleadScEta))*leadPt)",
					 "(TMath::Abs(leadScEta)<TMath::Abs(subleadScEta))*TMath::Abs(subleadScEta) + (TMath::Abs(leadScEta)>=TMath::Abs(subleadScEta))*TMath::Abs(leadScEta)",
					 "((TMath::Abs(leadScEta)<TMath::Abs(subleadScEta))*TMath::Abs(subleadScEta) + (TMath::Abs(leadScEta)>=TMath::Abs(subleadScEta))*TMath::Abs(leadScEta))<1.5"
					 ]
			    }
		},
		"_fill_categories" : {
		    "EBEB" : { "legs" : ["EBEB","EBEB"], "rndswap" : true, "nNeigh" : 25, "matchWithThreshold" : false,
			    "useCdfDistance" : true, "targetFraction" : 5e-2, "maxWeight" : 0.1,
			    "axesWeights" : [1.0,1.0],
			    "match1"  : ["log(phoPt)"    ,"TMath::Abs(phoScEta)"    ], 
			    "match2"  : ["log(phoPt)"    ,"TMath::Abs(phoScEta)"    ], 
			    "target1" : ["log(leadPt)"   ,"TMath::Abs(leadScEta)[0.2]"   ], 
			    "target2" : ["log(subleadPt)","TMath::Abs(subleadScEta)[0.2]"]
			    }
		},
		"_fill_categories" : {
		    "EBEB" : { "legs" : ["EBEB","EBEB"], "rndswap" : true, "nNeigh" : 10, "nMinNeigh" : 10, "matchWithThreshold" : false,
			    "useCdfDistance" : true, "targetFraction" : 1e-2,
			    "axesWeights" : [10.0,1.0,-1.0],
			    "match1"  : ["nvtx","log(phoPt)"    ,"TMath::Abs(phoScEta)"    ], 
			    "match2"  : ["nvtx","log(phoPt)"    ,"TMath::Abs(phoScEta)"    ], 
			    "target1" : ["nvtx","log(leadPt)"   ,"TMath::Abs(leadScEta)[0.2]"   ], 
			    "target2" : ["nvtx","log(subleadPt)","TMath::Abs(subleadScEta)[0.2]"]
			    }
		}
	}

    },
    "mix" : { 
	"kDSinglePho2D" : {
		"target" : "2D",
		"ptLeadMin" : 100.0, "ptSubleadMin" : 100.0, "massMin" : 200.0,
		"pt" : "phoPt", "eta" : "phoEta", "phi" : "phoPhi", "energy" : "phoEnergy",
		"sources" : { 
		    "pf" : [ "singlePho:p", "singlePho:f" ],
                    "ff" : [ "singlePho:f1", "singlePho:f2" ]
		    }, 
		"replace" : "pho",
		"type" : "kdtree",
		"transfer_variables" :["mass", "weightTarget:= weight"],
		"fill_categories" : {
		    "EBEB" : { "legs" : ["EB","EB"], "rndswap" : true,"rndmatch":0.8, "nNeigh" : 20, "nMinNeigh" : 10, "matchWithThreshold" : false,
			    "useCdfDistance" : true,"targetFraction" : 1e-2, "maxWeightTarget" :0.02, "maxWeightCache":1.0 ,
				"axesWeights" : [1.0,1.0,-1.0],
			    "match1"  : ["nvtx","log(phoPt)"    ,"TMath::Abs(phoScEta)"    ], 
			    "match2"  : ["nvtx","log(phoPt)"    ,"TMath::Abs(phoScEta)"    ], 
			    "target1" : ["nvtx","log(leadPt)"   ,"TMath::Abs(leadScEta)[0.2]"   ], 
			    "target2" : ["nvtx","log(subleadPt)","TMath::Abs(subleadScEta)[0.2]"]
			    },
		    "EBEE" : { "legs" : ["eta_inclusive","eta_inclusive"], "rndswap" : false, "nNeigh" : 20, "matchWithThreshold" : false,
			    "useCdfDistance" : true, "targetFraction" : 1e-2, "maxWeightTarget" :0.02, "maxWeightCache":1.0 ,"rndmatch":0.6,
			    "axesWeights" : [1.0,1.0,-1.0],
			    "match1"  : ["phoPhoIso","log(phoPt)" ,"TMath::Abs(phoScEta)"    ], 
			    "match2"  : ["phoPhoIso","log(phoPt)" ,"TMath::Abs(phoScEta)"    ], 
			    "target1" : ["(TMath::Abs(leadScEta)<TMath::Abs(subleadScEta))*leadPhoIso + (TMath::Abs(leadScEta)>=TMath::Abs(subleadScEta))*subleadPhoIso[10]",
					 "log((TMath::Abs(leadScEta)<TMath::Abs(subleadScEta))*leadPt       + (TMath::Abs(leadScEta)>=TMath::Abs(subleadScEta))*subleadPt)",
					 "(TMath::Abs(leadScEta)<TMath::Abs(subleadScEta))*TMath::Abs(leadScEta)    + (TMath::Abs(leadScEta)>=TMath::Abs(subleadScEta))*TMath::Abs(subleadScEta)"
					 ],
			    "target2" : ["(TMath::Abs(leadScEta)<TMath::Abs(subleadScEta))*subleadPhoIso + (TMath::Abs(leadScEta)>=TMath::Abs(subleadScEta))*leadPhoIso[10]",
					 "log((TMath::Abs(leadScEta)<TMath::Abs(subleadScEta))*subleadPt    + (TMath::Abs(leadScEta)>=TMath::Abs(subleadScEta))*leadPt)",
					 "(TMath::Abs(leadScEta)<TMath::Abs(subleadScEta))*TMath::Abs(subleadScEta) + (TMath::Abs(leadScEta)>=TMath::Abs(subleadScEta))*TMath::Abs(leadScEta)"
					 ]
				},
			"_EBEE" : { "legs" : ["eta_inclusive","eta_inclusive"], "rndmatch":0.5,"nNeigh" : 10, "nMinNeigh" : 10,
			    "useCdfDistance" : true, "matchWithThreshold" : false,
			    "match1"  : ["nvtx","log(phoPt)" ,"TMath::Abs(phoScEta)","TMath::Abs(phoScEta)<1.5"    ], 
			    "match2"  : ["nvtx","log(phoPt)" ,"TMath::Abs(phoScEta)","TMath::Abs(phoScEta)<1.5"    ], 
			    "target1" : ["nvtx",
					 "log((TMath::Abs(leadScEta)<TMath::Abs(subleadScEta))*leadPt       + (TMath::Abs(leadScEta)>=TMath::Abs(subleadScEta))*subleadPt)",
					 "(TMath::Abs(leadScEta)<TMath::Abs(subleadScEta))*TMath::Abs(leadScEta)    + (TMath::Abs(leadScEta)>=TMath::Abs(subleadScEta))*TMath::Abs(subleadScEta)",
					 "((TMath::Abs(leadScEta)<TMath::Abs(subleadScEta))*TMath::Abs(leadScEta)    + (TMath::Abs(leadScEta)>=TMath::Abs(subleadScEta))*TMath::Abs(subleadScEta))<1.5"
					 ],
			    "target2" : ["nvtx",
					 "log((TMath::Abs(leadScEta)<TMath::Abs(subleadScEta))*subleadPt    + (TMath::Abs(leadScEta)>=TMath::Abs(subleadScEta))*leadPt)",
					 "(TMath::Abs(leadScEta)<TMath::Abs(subleadScEta))*TMath::Abs(subleadScEta) + (TMath::Abs(leadScEta)>=TMath::Abs(subleadScEta))*TMath::Abs(leadScEta)[0.3]",
					 "((TMath::Abs(leadScEta)<TMath::Abs(subleadScEta))*TMath::Abs(subleadScEta) + (TMath::Abs(leadScEta)>=TMath::Abs(subleadScEta))*TMath::Abs(leadScEta))<1.5"
					 ]
			    }
		}
	}

    },
    "comparisons" : {
	"_mixClosure" : { "fit" : "2D",
		"templates" : { "mix:kDClosure2D" : {} },
                "components": [["pf",{"2D":{},"mix:kDClosure2D" : {} }]], "categories" : ["EBEB","EBEE"],
                "prepfit": true,
                "weight_cut": "weight < 5.",
		"redo" : true,
		"doDataMc" : false, "doMcTruth" : true,
		    "template_binning" : [ 0.0,0.1,5.0,15.0],
		    "_template_binning" : [ 0.0,0.1,1.0,2.0,4.0,5.0,8.0,15.0],
		"mass_binning" :"mass[13000,0.0,13000.0]"
		},
	"fit2DTruth" : { "fit" : "2D",
		"templates" : { "mix:kDSinglePho2D" : {},"2D":{} },
                "_components": [["pf",{"2D":{},"mix:kDSinglePho2D" : {} }]], "categories" : ["EBEE","EBEB"],
                "components": ["pf","ff",  ["pp",{ "2D" : {}}] 
                ],
                "prepfit": true,
                "weight_cut": "weight < 5.",
		"redo" : true,
		"doDataMc" : false, "doMcTruth" : true,
                "template_binning" : [ 0.0,0.1,5.0,15.0],
 
                "lowerLimitSigRegion2D": "0.", 
                "_upperLimitSigRegion2D": "4.", 
                "_upperLimitSigRegion1D": "5.", 
                "upperLimitSigRegion2D": "9.", 
                "upperLimitSigRegion1D": "15.", 
		"mass_binning" :"mass[13000,0.0,13000.0]"
		},
	"_fit1DTruth" : { "fit" : "1D",
                "components" : [ "f", ["fwhigh",{"singlePho":{}}],["fwlow",{"singlePho":{}}],"p" ],
		"templates" : {"singlePho" : { "EBEB" : "EB", "EBEE" : "EB", "EEEB" : "EE" ,"eta_inclusive":"eta_inclusive" }
                                 ,"1D" : {} 
                            
                            },
                "prepfit": false,
		"redo" : true,
		"weight_cut": "weight < 1000.",
		"doDataMc" : false, "doMcTruth" : true,
                "template_binning" : [ 0.0,0.1, 5.0,15.0 ],
		"mass_binning" :"mass[13000,0.0,13000.0]"
		}
	},
   "nominalFit":{
        " 3_components":{
                "dimensions" :"2D", 
                "observable": "templateNdim2d_unroll",
                "components": ["pp","pf","ff"],
                "lowerLimitSigRegion": "0.", 
                "upperLimitSigRegion": "9.", 
                "_upperLimitSigRegion": "4.", 
		"mass_binning" :"mass[13000,0.0,13000.0]",
                "extended_fit":"false"
         },
        "_2_components":{
                "dimensions" :"2D", 
                "observable": "templateNdim2d_unroll",
                "components": ["pp","pf"],
                "data": "unrolled_data", 
                "lowerLimitSigRegion": "0.", 
                "upperLimitSigRegion": "4.", 
		"mass_binning" :"mass[13000,0.0,13000.0]"
        }
    },
   "plotPurity":{
                "_treetruth":"truth_purity_all",
                "treetruth":"truth_purity_signalregion",
                "dimensions" :"2D", 
                "categories" :["EBEE"]
    },
    "rootstyle_extra" : [
                  "TGaxis::SetMaxDigits(3);",
                  "TH1::SetDefaultSumw2(1);"
    ]
    
}
